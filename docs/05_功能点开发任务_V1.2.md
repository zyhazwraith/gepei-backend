# 陪你App - 功能点开发任务清单 V1.2

**版本**: V1.2  
**更新日期**: 2026-01-20  
**修改说明**: 
1. 确认FP001-FP012核心功能已基本完成（部分待优化）
2. 新增交易侧核心功能（FP013-FP017），包括下单、支付模拟、订单管理
3. 调整优先级，确保闭环交易流程优先于非核心展示功能

---

## 功能点总览表

| 功能点 | 功能名称 | 优先级 | 工作量 | 预计完成日期 | 状态 |
| :--- | :--- | :--- | :--- | :--- | :--- |
| FP-001 | 项目初始化 | P0 | - | - | ✅ 已完成 |
| FP-002 | 用户注册 | P0 | - | - | ✅ 已完成 |
| FP-003 | 用户登录 | P0 | - | - | ✅ 已完成 |
| FP-004 | 获取当前用户 | P0 | - | - | ✅ 已完成 |
| FP-005 | 地陪认证 | P0 | - | - | ✅ 已完成 |
| FP-006 | 地陪资料编辑 | P0 | - | - | ✅ 已完成 |
| FP-007 | 地陪照片上传 | P0 | - | - | ✅ 已完成 |
| FP-008 | 地陪列表 | P0 | - | - | ✅ 已完成 |
| FP-009 | 地陪详情 | P0 | - | - | 🚧 开发中 |
| FP-010 | 首页和导航栏 | P0 | - | - | ✅ 已完成 |
| FP-011 | 管理员登录 | P1 | 0.5天 | 待定 | ✅ 已完成 |
| FP-012 | 用户列表（后台） | P1 | 1天 | 待定 | ✅ 已完成 |
| **FP-013** | **定制下单** | **P0** | **1.5天** | **TBD** | **✅ 已完成** |
| **FP-014** | **订单列表** | **P0** | **1天** | **TBD** | **✅ 已完成** |
| **FP-015** | **订单详情** | **P0** | **1天** | **TBD** | **✅ 已完成** |
| **FP-016** | **支付模拟** | **P0** | **0.5天** | **TBD** | **🚧 开发中** |
| **FP-017** | **订单管理(后台)** | **P1** | **1天** | **TBD** | **✅ 已完成** |
| **FP-018** | **地陪预订** | **P0** | **1天** | **TBD** | **✅ 已完成** |

**新增工作量**: 后端约4天，前端约3天，总计约7天。

---

## 新增功能点详细说明

### FP-018: 地陪预订 (Guide Booking)

**功能描述**: 用户在地陪详情页点击“立即预订”，填写日期和时长后直接下单。

#### 后端任务清单
- [ ] 修改 `createOrder` 接口，支持 `normal` 类型订单
- [ ] 校验 `guide_id` 有效性
- [ ] 计算订单金额 (`hourly_price` * `hours`)

#### 前端任务清单
- [ ] 创建预订页面 `OrderCreate.tsx`
- [ ] 获取 URL 参数中的 `guide_id` 并加载信息
- [ ] 表单提交与金额计算

### FP-013: 定制下单

**功能描述**: 用户在选择地陪后，填写日期、人数、需求等信息进行下单。

#### 后端任务清单
- [ ] 创建 `orders` 表 (id, user_id, guide_id, status, total_amount, start_date, end_date, remark, created_at...)
- [ ] 实现 POST /orders API
- [ ] 校验地陪状态和时间冲突（简化版：暂不校验具体排期，仅校验地陪存在性）
- [ ] 计算订单金额（基于地陪时薪 * 预估时长 或 天数）

**API规范**:
- 端点: POST /api/v1/orders
- 请求: `{ guide_id, start_date, end_date, hours_per_day, remark }`
- 响应: `{ order_id, total_amount, status }`

#### 前端任务清单
- [ ] 创建下单页面 `OrderCreate.tsx`
- [ ] 显示地陪基本信息卡片
- [ ] 日期选择器组件
- [ ] 金额自动计算展示
- [ ] 提交订单并跳转到收银台/订单详情

---

### FP-014: 订单列表

**功能描述**: 用户和地陪查看自己的订单列表。

#### 后端任务清单
- [ ] 实现 GET /orders API
- [ ] 支持身份区分（用户查自己下的单，地陪查自己接的单）
- [ ] 支持状态筛选（待支付、待服务、进行中、已完成、已取消）

#### 前端任务清单
- [ ] 创建订单列表页 `OrderList.tsx`
- [ ] 选项卡切换（全部/待支付/待服务...）
- [ ] 订单卡片组件（显示关键信息和操作按钮）

---

### FP-015: 订单详情

**功能描述**: 查看订单详细信息及状态流转。

#### 后端任务清单
- [ ] 实现 GET /orders/:id API
- [ ] 权限校验（只能看自己的订单）

#### 前端任务清单
- [ ] 创建订单详情页 `OrderDetail.tsx`
- [ ] 展示订单状态进度条
- [ ] 展示订单详细信息
- [ ]根据状态显示操作按钮（去支付、取消订单、确认完成）

---

### FP-016: 支付模拟
 
 **功能描述**: 模拟支付流程，将订单状态从“待支付”变更为“待服务”。
 
 #### 后端任务清单
 - [ ] 实现 POST /orders/:id/pay API
 - [ ] 模拟支付成功逻辑（直接修改状态）
 
 #### 前端任务清单
 - [ ] 创建收银台组件 `PaymentSheet.tsx` (抽屉式)
 - [ ] 支付方式选择（模拟）
 - [ ] 支付成功后回调

---

### FP-017: 订单管理（后台）

**功能描述**: 管理员查看和管理所有订单。

#### 后端任务清单
- [ ] 实现 GET /admin/orders API
- [ ] 实现 PUT /admin/orders/:id/status API (强制改状态)

#### 前端任务清单
- [ ] 创建后台订单列表页 `AdminOrderList.tsx`
- [ ] 搜索和筛选功能
- [ ] 详情查看和状态干预功能
