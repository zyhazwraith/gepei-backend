# FP13 私人定制单功能转测报告

## 1. 功能概述
本次交付包含 **FP13 私人定制单** 的核心用户流程，支持用户发起定制需求、支付订金、以及查看订单详情和状态。

## 2. 变更范围
### 2.1 后端 (Backend)
- **新增接口**:
  - `POST /api/v1/orders`: 创建定制订单。
  - `GET /api/v1/orders/:id`: 获取订单详情（包含定制需求 `custom_requirements`）。
  - `POST /api/v1/orders/:id/payment`: 支付订单（模拟微信支付）。
- **数据库变更**:
  - `orders` 表: 存储订单主信息。
  - `custom_requirements` 表: 存储定制单的详细需求（城市、日期、预算等）。
  - `payments` 表: 存储支付流水。

### 2.2 前端 (Frontend)
- **新增页面**:
  - `client/src/pages/Custom.tsx`: 定制单发起页（多步骤表单：需求 -> 确认 -> 支付）。
  - `client/src/pages/OrderDetail.tsx`: 订单详情页（展示状态、需求、费用，支持待支付状态下的支付操作）。
- **路由**:
  - `/custom`: 发起定制。
  - `/orders/:id`: 订单详情。

## 3. 验证结果
### 3.1 自动化测试
已通过自动化测试脚本验证核心链路。
- **脚本路径**: `scripts/test-order-flow.ts`
- **覆盖场景**:
  1. 用户注册/登录。
  2. 创建定制订单 (校验 201 Created)。
  3. 查询订单详情 (校验初始状态 `pending` 及需求字段)。
  4. 支付订金 (校验支付成功)。
  5. 再次查询详情 (校验状态更新为 `paid`)。
- **运行结果**: Pass

### 3.2 编译与构建
- `npm run build`: **Success** (已修复 TypeScript 类型报错)。

## 4. 测试建议 (QA)
建议 QA 重点关注以下场景：

### 4.1 发起定制
- **必填校验**: 服务日期、城市、内容、预算为空时应有提示。
- **数据格式**: 预算输入非数字，日期格式不合法等。

### 4.2 支付流程
- **待支付状态**: 下单后应跳转/可进入详情页进行支付。
- **重复支付**: 已支付订单不应再次显示支付按钮（前端已隐藏，后端接口有状态校验）。

### 4.3 订单详情
- **信息回显**: 确认详情页展示的“目的地”、“日期”、“需求描述”与下单时填写的一致。
- **状态流转**: 支付后状态应立即变为“待接单”。

## 5. 已知限制
- **支付方式**: 目前仅支持模拟“微信支付”，点击即成功，无真实支付网关对接。
- **后台管理**: 管理员指派地陪的功能目前仅有数据库表结构支持，尚未包含在此次交付的前端页面中。
