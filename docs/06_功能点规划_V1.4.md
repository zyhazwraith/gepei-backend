# 陪你App - 功能点规划 V1.4

**状态**: 开发中  
**日期**: 2026-01-21  
**版本**: V1.4

---

## 0. 紧急修复 (Critical Fixes)

| ID | 修复项 | 问题描述 | 状态 | 优先级 |
| :--- | :--- | :--- | :--- | :--- |
| BUG-001 | 首页及交互报错 | 首页点击地陪卡片跳转错误 (undefined id)，导致 404。 | **已修复** | **P0** |

---

## 1. 核心体验优化 (Experience Optimization)

| ID | 优化项 | 问题描述 | 预期效果 | 优先级 |
| :--- | :--- | :--- | :--- | :--- |
| OPT-001 | (待补充) | | | |

---

## 2. 新功能特性 (New Features)

| ID | 功能名称 | 需求描述 | 状态 | 优先级 |
| :--- | :--- | :--- | :--- | :--- |
| FEAT-001 | 定制单撮合流程升级 | **新需求**: 管理员筛选推荐(至多5人) -> 用户从候选列表中反选确认。 | **已完成** | **P0** |
| FEAT-002 | LBS 地理位置服务 | **新需求**: 记录地陪真实经纬度；展示地陪与用户的距离。 | **设计完成/待开发** | **P1** |
| FEAT-003 | 微信支付接入 | **新需求**: 评估并接入真实微信支付功能。 | **待评估** | **P1** |

---

## 3. 详细需求分析 (Detailed Analysis)

### 3.1 [FEAT-001] 定制单撮合流程升级 (Completed)
- **流程**: 
  1. 用户发布定制单。
  2. 管理员后台筛选候选人 (Max 5)。
  3. 订单状态变更为 `waiting_for_user`。
  4. 用户查看候选人列表，选择一位。
  5. 订单状态变更为 `in_progress`。

### 3.2 [FEAT-002] LBS 地理位置服务 (Detailed Design)

#### 1. 交互设计 (地陪端)
- **页面**: `GuideEdit` (地陪资料编辑) / `Register` (注册)
- **输入项**:
  - **城市 (City)**: **必填**。
    - 交互升级: 使用 **城市选择器** (CitySelector)。
    - 内容: 展示热门城市 (北京、上海...) + 按省份/拼音折叠的完整列表。
    - 目的: 规范数据，用于粗粒度筛选。
  - **当前位置 (Location)**: **选填** (强烈推荐)。
    - 交互: 点击 **"获取当前位置"** 按钮。
    - 逻辑: 调用浏览器 `navigator.geolocation` 获取精准经纬度 (Lat/Lng)，**仅用于计算距离，不反向填充城市**。
    - 状态: 成功显示 "✅ 已获取精准坐标"，失败提示手动输入城市即可。

#### 2. 展示场景 (用户端)
所有展示地陪的页面均需增加距离提示 (需获取用户当前坐标)：
- **首页 (Home)**: 推荐地陪卡片增加 "距离 xx km" 标签。
- **列表页 (Guides)**: 列表项增加 "距离 xx km"。
- **详情页 (GuideDetail)**: 顶部基本信息区显示 "距离您约 xx km"。
- **排序**: 本版本暂不实现 "按距离排序"，仅做距离展示。

#### 3. 技术实现
- **数据层**: User/Guide 表增加 `latitude`, `longitude` 字段 (Decimal 10,6)。
- **后端**: 
  - `POST /guides/profile`: 接收 `latitude`, `longitude`。
  - `GET /guides`: 接收 `lat`, `lng` 参数，使用 Haversine 公式计算距离并返回 `distance` 字段。
- **前端**: 
  - **组件**: 开发 `CitySelector` (热门+省份列表), `LocationButton` (封装定位逻辑)。
  - **Hook**: 封装 `useGeolocation`。

### 3.3 [FEAT-003] 微信支付接入 (Pending)
- **前提**: 需要企业资质申请微信支付商户号。
- **替代方案**: 如果无法申请商户号，继续优化模拟支付体验。
