# LBS 地理位置服务测试用例 (Test Cases)

**版本**: V1.0  
**日期**: 2026-01-21  
**范围**: 地陪坐标更新、距离计算  
**前置条件**: 
1. 数据库已执行 V1.2 Migration (添加 latitude/longitude)。
2. 后端服务已启动。

---

## TC-LBS-001: 地陪更新坐标 (Success)

**目标**: 验证地陪可以通过 API 成功更新经纬度。

**步骤**:
1. 注册/登录一个地陪账号 (Guide A)。
2. 调用 `POST /guides/profile`，Body 包含:
   ```json
   {
     "name": "Test Guide",
     "city": "Beijing",
     "idNumber": "110101199001011234",
     "latitude": 39.904200, 
     "longitude": 116.407400
   }
   ```
3. 验证响应状态码为 200。
4. 验证响应 Body 中 `data.latitude` == 39.904200, `data.longitude` == 116.407400。
5. 再次调用 `GET /guides/profile`，验证返回的坐标一致。

---

## TC-LBS-002: 地陪更新坐标 (Invalid Data)

**目标**: 验证非法的经纬度数据会被拒绝。

**步骤**:
1. 登录地陪账号。
2. 调用 `POST /guides/profile`，发送无效坐标 (e.g., lat > 90):
   ```json
   {
     "latitude": 91.000000,
     "longitude": 0.000000
   }
   ```
3. 验证响应状态码为 400 (Bad Request)。
4. 验证错误信息提示坐标无效。

---

## TC-LBS-003: 距离计算 (Haversine Formula)

**目标**: 验证列表接口能根据用户坐标正确计算距离。

**场景**: 
- 地陪 A (北京天安门): 39.9087, 116.3975
- 用户 B (北京王府井): 39.9110, 116.4109
- 预期距离: 约 1.2 km

**步骤**:
1. 设置地陪 A 的坐标为 (39.9087, 116.3975)。
2. 调用 `GET /guides?lat=39.9110&lng=116.4109`。
3. 在返回列表中找到地陪 A。
4. 验证 `distance` 字段存在，且值在 1.1 - 1.3 之间 (允许微小误差)。

---

## TC-LBS-004: 未提供坐标时不返回距离

**目标**: 验证当请求未携带用户坐标时，接口不返回距离字段。

**步骤**:
1. 调用 `GET /guides` (不带 lat/lng)。
2. 检查返回列表中的地陪对象。
3. 验证 `distance` 字段不存在 (undefined) 或为 null。

---

## TC-LBS-005: 距离展示精度

**目标**: 验证前端展示的距离格式是否友好。

**步骤**:
1. 模拟 API 返回 `distance`: 1.23456 km。
2. 验证前端展示为 "1.2 km" 或 "1.23 km" (保留1-2位小数)。
3. 模拟 API 返回 `distance`: 0.5 km。
4. 验证前端展示为 "0.5 km" 或 "500 m"。
