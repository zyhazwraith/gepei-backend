# 陪你App - 数据库设计 V1.2

**版本**: 1.2  
**更新日期**: 2026年1月21日  
**用途**: V1.4 LBS 版本数据库设计。

---

## 1. 变更记录 (Changelog)

| 版本 | 日期 | 变更内容 |
| :--- | :--- | :--- |
| V1.1 | 2026-01-18 | 初始 MVP 版本 |
| V1.2 | 2026-01-21 | 新增 LBS 字段 (latitude, longitude) |

---

## 2. 核心表结构

### 2.1. users (用户表)

> 变更: 新增 `latitude`, `longitude`

```sql
CREATE TABLE users (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  phone VARCHAR(20) UNIQUE NOT NULL COMMENT '手机号',
  password_hash VARCHAR(255) NOT NULL COMMENT 'bcrypt加密密码',
  nickname VARCHAR(100) COMMENT '昵称',
  avatar_url VARCHAR(500) COMMENT '头像URL',
  role VARCHAR(50) DEFAULT 'user' COMMENT '角色: user/admin',
  
  -- 地陪认证
  is_guide BOOLEAN DEFAULT FALSE,
  guide_id_number VARCHAR(50) COMMENT '身份证号',
  guide_id_verified_at TIMESTAMP NULL,
  
  -- 余额
  balance DECIMAL(10, 2) DEFAULT 0,

  -- LBS (V1.2 新增)
  latitude DECIMAL(10, 6) COMMENT '纬度',
  longitude DECIMAL(10, 6) COMMENT '经度',
  
  -- 审计
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  deleted_at TIMESTAMP NULL,
  
  KEY idx_phone (phone),
  KEY idx_role (role),
  KEY idx_is_guide (is_guide)
);
```

### 2.2. guides (地陪资料表)

> 变更: 新增 `latitude`, `longitude`，用于地陪展示位置

```sql
CREATE TABLE guides (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  user_id BIGINT NOT NULL UNIQUE,
  name VARCHAR(100) NOT NULL,
  city VARCHAR(50) NOT NULL,
  intro TEXT,
  hourly_price DECIMAL(10, 2),
  
  -- LBS (V1.2 新增)
  latitude DECIMAL(10, 6) COMMENT '纬度',
  longitude DECIMAL(10, 6) COMMENT '经度',

  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  deleted_at TIMESTAMP NULL,
  
  FOREIGN KEY (user_id) REFERENCES users(id),
  KEY idx_city (city),
  KEY idx_location (latitude, longitude) -- 空间索引建议
);
```

### 2.3 - 2.9 其他表结构保持不变 (参考 V1.1)
* guide_photos
* guide_tags
* orders
* custom_order_details
* custom_order_candidates
* messages
* admin_logs

---

## 3. 关键设计说明 (V1.2)

- **经纬度存储**: 使用 `DECIMAL(10, 6)` 类型存储经纬度，精度约为 0.1 米，满足日常定位需求。
- **空间索引**: 虽然 MySQL 支持 `POINT` 类型和 `SPATIAL INDEX`，但在 MVP 阶段为简化开发，可暂时使用 `DECIMAL` 配合普通索引或 Bounding Box 查询。若性能瓶颈，后续迁移至 Spatial 类型。
