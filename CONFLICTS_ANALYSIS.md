# FP-005地陪认证功能 - 文档冲突分析报告

## 📋 文档检查结果

### 1. API设计文档 (03_API设计_V1.2.md)

**接口定义**: `PUT /guides/profile`

**请求体字段**:
```json
{
  "id_number": "110101199003071234",
  "nickname": "张三",
  "city": "北京",
  "avatar_url": "https://...",
  "photos": ["https://...", "https://..."],
  "hourly_price": 300,
  "intro": "我是一个专业地陪...",
  "tags": ["历史", "美食"]
}
```

**响应体字段**:
```json
{
  "guide_id": 456,
  "user_id": 123,
  "id_number": "110101199003071234",
  "id_verified_at": "2026-01-18T10:00:00Z",
  "nickname": "张三",
  "city": "北京",
  "avatar_url": "https://...",
  "photos": ["https://...", "https://..."],
  "hourly_price": 300,
  "intro": "我是一个专业地陪...",
  "tags": ["历史", "美食"]
}
```

**验证规则**:
- 身份证号：18位数字或17位数字+X，格式校验
- 昵称：2-20个字符
- 城市：必选
- 照片：最多5张，每张不超过5MB
- 小时价格：正整数，范围100-10000
- 个人介绍：1-500个字符
- 技能标签：至少选择1个，最多5个

**⚠️ 关键发现**:
1. **没有独立的文件上传接口** - API文档中没有定义`POST /upload`接口
2. **avatar_url在请求体中** - 说明头像URL应该由前端直接提供
3. **photos是URL数组** - 说明照片URL也应该由前端直接提供

---

### 2. 架构设计文档 (01_技术架构设计_V1.0.md)

**图片存储方案**:
> MVP阶段直接存储在服务器本地文件系统，通过Nginx提供访问。未来可平滑迁移至对象存储。

**⚠️ 关键发现**:
1. **存储在本地文件系统** - 不是S3，是服务器本地
2. **通过Nginx提供访问** - 需要配置静态文件服务
3. **没有提到上传接口的实现细节**

---

### 3. UI设计稿 (05_guide_edit.png)

**页面元素**:
- 头像上传区域（120px圆形虚线，"点击上传头像"）
- 昵称输入框
- 所在城市（下拉选择，默认"北京"）
- 我的照片（最多5张，120px正方形）
- 服务价格（¥/小时）
- 个人简介（最多200字）
- 服务技能（标签选择）

**⚠️ 关键发现**:
1. **没有身份证号输入框** - 与API文档冲突！
2. **没有真实姓名输入框** - 与用户反馈冲突！
3. **有头像上传** - 与用户反馈"头像是用户公共的"冲突！
4. **城市是下拉选择** - 与用户反馈"需要支持搜索"冲突！

---

## 🔴 冲突点总结

### 冲突1: nickname vs name

**API文档**: 使用`nickname`字段  
**数据库schema**: 使用`name`字段（真实姓名）  
**用户反馈**: nickname是用户昵称，name是地陪真实姓名  

**结论**: 
- API文档中的`nickname`字段**有误**，应该是`name`（真实姓名）
- 需要在API请求体中添加`name`字段
- 数据库schema正确

---

### 冲突2: 头像上传

**UI设计稿**: 有头像上传区域  
**API文档**: 请求体包含`avatar_url`字段  
**用户反馈**: 头像是用户公共的，地陪不能单独上传头像  

**结论**:
- UI设计稿**有误**，应该删除头像上传区域
- API文档**有误**，应该删除`avatar_url`字段
- 头像应该使用`users.avatar_url`，在用户个人资料中修改

---

### 冲突3: 身份证号和真实姓名输入框

**UI设计稿**: 没有身份证号和真实姓名输入框  
**API文档**: 要求`id_number`必填  
**用户反馈**: 需要验证姓名和身份证  

**结论**:
- UI设计稿**不完整**，需要添加：
  - 身份证号输入框（18位）
  - 真实姓名输入框

---

### 冲突4: 城市选择方式

**UI设计稿**: 下拉选择（固定列表）  
**用户反馈**: 需要支持搜索  

**结论**:
- UI设计稿**有误**，需要改为支持搜索的城市选择器

---

### 冲突5: 文件上传接口

**当前实现**: 前端调用`POST /api/v1/upload`  
**API文档**: 没有定义该接口  
**架构文档**: 存储在本地文件系统，通过Nginx提供访问  

**结论**:
- **需要实现`POST /api/v1/upload`接口**
- 文件存储到本地文件系统（如`/uploads`目录）
- 返回可访问的URL（如`https://api.gepei.com/uploads/xxx.jpg`）

---

## ✅ 修正方案

### 1. API接口修正

**请求体** (修正后):
```json
{
  "id_number": "110101199003071234",
  "name": "张三",              // 改为name（真实姓名）
  "city": "北京",
  "photos": ["https://...", "https://..."],
  "hourly_price": 300,
  "intro": "我是一个专业地陪...",
  "tags": ["历史", "美食"]
  // 删除avatar_url字段
}
```

### 2. UI页面修正

**需要添加**:
- 身份证号输入框（在头像下方）
- 真实姓名输入框（在身份证号下方）
- 城市搜索功能（替换固定下拉列表）

**需要删除**:
- 头像上传区域

### 3. 后端接口修正

**需要实现**:
- `POST /api/v1/upload` - 文件上传接口
  - 接收multipart/form-data
  - 保存到本地文件系统
  - 返回可访问的URL

**需要修改**:
- `PUT /api/v1/guides/profile`
  - 将`nickname`改为`name`
  - 删除`avatar_url`字段处理
  - 使用`users.avatar_url`作为头像

---

## 📝 建议

1. **更新API设计文档** - 添加文件上传接口定义
2. **更新UI设计稿** - 添加身份证号和真实姓名输入框，删除头像上传
3. **更新数据库文档** - 明确`name`字段的含义（真实姓名）
